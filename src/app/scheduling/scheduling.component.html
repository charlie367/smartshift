<div class="top-tag">   
  
  <div class="menu-item1" (click)="openAnnouncementDialog()">
    <mat-icon
      matBadge="{{ unreadCount }}"
      [matBadgeHidden]="unreadCount === 0"
      matBadgeColor="warn"
      matBadgePosition="above after">
      notifications
    </mat-icon>
  </div>
  

</div>

<div class="sidebar">

    <div class="logo-text"> <img src="shift.png" class="tag-icon" alt="logo" />EasyShift</div>


  <div class="menu-item"  (click)="punchIn()">
    <mat-icon>schedule</mat-icon>
    <label>打卡</label>
  </div>
  <div class="menu-item" (click)="close()">
    <span class="material-symbols-outlined">calendar_month</span>
    <label>排班</label>
  </div>
  <div class="menu-item" (click)="openFeedbackDialog()">
    <mat-icon>speaker_notes</mat-icon>
    <label >問題意見</label>
  </div>

  <div class="menu-item" (click)="showSchedule()">
    <mat-icon>next_week</mat-icon>
    <label>班表總覽
    </label>
  </div>

  <div class="menu-item" routerLink="/leave" style="cursor: pointer;">
    <mat-icon>text_snippet</mat-icon>
    <label>請假申請</label>
  </div>
  <div class="logout-section">
    <hr class="divider" />
  
    @if (viewMode === 'dashboard') {
      <div class="menu-item logout" (click)="logout()">
        <mat-icon>logout</mat-icon>
        <label>登出</label>
      </div>
    } @else if (viewMode === 'schedule') {
      <div class="menu-item logout" (click)="goHome()">
        <mat-icon>home</mat-icon>
        <label>回首頁</label>
      </div>
    }
  </div>
  
</div>
<div *ngIf="viewMode === 'dashboard'">

  <div class="dashboard-row">

    <div class="left-col">

       <div class="chat-box">
        <div *ngFor="let msg of messages" [ngClass]="msg.sender">
          <ng-container *ngIf="msg.sender === 'assistant'">
            <img src="kawaii.png" alt="助理" class="assistant-avatar" />
          </ng-container>
          <div class="msg">
            <p style="color: #505050">
              {{ msg.text }}
            </p>
          </div>
        </div>
        <div class="chat-box-input-group">
          <input
            class="chat-box-input"
            type="text"
            placeholder="我有話想說 ..."
          />
          <img src="send.png" alt="" width="28px" />
        </div>
      </div>

      <main class="calendar-container">
        <p class="title">選取預約時段</p>

        <div class="left-calendar">
          <mat-calendar
            [selected]="selectedDate"
            (selectedChange)="onDateSelected($event)">
          </mat-calendar>
        </div>

        <br>

        <div class="right-week">
          <div class="week-header">
            <button mat-icon-button (click)="prevWeek()">
              <img src="arrow-left.png" alt="" />
            </button>
            <div class="week-label">
              {{ weekDays[0] | date:'MM/dd' }} - {{ weekDays[6] | date:'MM/dd' }}
            </div>
            <button mat-icon-button (click)="nextWeek()">
              <img src="arrow-right.png" alt="" />
            </button>
          </div>

          <div class="week-grid">
            <div class="week-day" *ngFor="let d of weekDays">
              <div class="day-title">
                {{ d | date:'E' }} <br>
                {{ d | date:'MM/dd' }}
              </div>
              <div class="day-slots">
                <!-- 有班就畫卡片，沒有就走 else -->
                <ng-container *ngIf="acceptedSlots(weekSlots[dateKey(d)]).length; else _noSlots">
                  <div class="slot-col">
                    <div
                      *ngFor="let s of acceptedSlots(weekSlots[dateKey(d)]); trackBy: trackBySlot"
                      class="slot-vertical"
                      [ngClass]="shiftTag(s)"
                      [style.width.px]="50"
                    >
                      <div class="sv-time">{{ toHM(s.startTime) }}</div>
                      <div class="sv-bar"></div>
                      <div class="sv-time">{{ toHM(s.endTime) }}</div>
                    </div>
                  </div>
                </ng-container>
              
                <ng-template #_noSlots>—</ng-template>
              </div>
              
              
              
            </div>
          </div>
        </div>
      </main>

    </div>


    <aside class="right-aside">
      <div class="widget-card">
        <div class="widget-header">時鐘</div>
        <div class="widget-body clock-body" >
          <app-clock class="clock-inline"></app-clock>
        </div>
      </div>
      


      <div class="widget-card">
        <div class="widget-header">
          <span>本月薪水</span>
          <span class="salary-value">薪水: 30000</span>
        </div>
        <div class="widget-body salary-body">
          <app-water-drop [level]="80" class="drop"></app-water-drop>
        </div>
      </div>
      
    </aside>
    
  </div>

<div class="dashboard-layout">

  <div class="month-container">

    <div class="month-header">
      <button class="arrow" (click)="prevMonth()">
        <img src="arrow-left.png" alt=""style="width: 24px;" />
      </button>
      <div class="month-title">

        {{ currentMonthName }}
      </div>
      <button class="arrow" (click)="nextMonth()">  <img src="arrow-right.png" alt=""style="width: 24px;" /></button>
    </div>

    <div class="stats-row">
      <div class="stat-card green">
        <mat-icon>login</mat-icon>
        <div>
          <div class="value">{{ avgCheckIn }}</div>
          <div class="label">平均上班時間</div>
        </div>
      </div>
      
      <div class="stat-card orange">
        <mat-icon>logout</mat-icon>
        <div>
          <div class="value">{{ avgCheckOut }}</div>
          <div class="label">平均下班時間</div>
        </div>
      </div>
      
      <div class="stat-card purple">
        <mat-icon>schedule</mat-icon>
        <div>
          <div class="value">{{ avgWorkHr }}</div>
          <div class="label">平均工時</div>
        </div>
      </div>
      
      <div class="stat-card red">
        <mat-icon>block</mat-icon>
        <div>
          <div class="value">{{ absentLeaves }}</div>
          <div class="label">缺勤/請假</div>
        </div>
      </div>
</div>      
    

    <!-- 出勤紀錄表格 -->
    <div class="work-log-table-wrapper">
      <table class="work-log-table">
        <thead>
          <tr>
            <th>日期</th>
            <th>上班打卡</th>
            <th>下班打卡</th>
            <th>工時</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of workLogs">
            <td>{{ record.date }}</td>
            <td class="checkin">{{ record.checkIn }}</td>
            <td class="checkout">{{ record.checkOut }}</td>
            <td>{{ record.hours }}</td>
          </tr>
        </tbody>
      </table>
      
    </div>
  </div>


  <div class="widget-card employee-card">
    <div class="widget-header">今日出勤人員</div>
    <div class="widget-body">
      <div class="employee-list">
        <div class="employee-item" *ngFor="let s of shifts">
          <div class="info">
            <div class="name">{{ s.name }}</div>
            <div class="detail">{{ s.date }}</div>

            <div class="extra">班別：{{ s.type }}</div>
          </div>
          <div class="role">職別：{{ s.role }}</div>
        </div>
      </div>
    </div>
  </div>
</div>

</div> 
<div *ngIf="viewMode === 'schedule'" class="schedule-wrapper">
  <daypilot-scheduler
    #scheduler
    [config]="config"
    [events]="events">
  </daypilot-scheduler>
</div>