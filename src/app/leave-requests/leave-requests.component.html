<div class="page">
  <div class="container">
    <div class="card header lr-wrap">
      <!-- æ¨™é¡Œ + è¿”å› -->
      <div class="lr-wrap__head">
        <div class="page-head">
          <div class="head-left">
            <span class="material-symbols-rounded">calendar_month</span>
            <div>
              <div class="head-title">è«‹å‡ç”³è«‹æŸ¥çœ‹</div>
            </div>
          </div>
          <button class="btn-back" routerLink="/leave" type="button">
            <span class="material-symbols-rounded">arrow_back</span>
            è¿”å›
          </button>
        </div>
      </div>

      <div class="lr-wrap__rail">
        <div class="month-rail">
          <button class="rail-nav left" (click)="changeMonth(-1)" aria-label="ä¸Šä¸€æœˆ">
            <span class="material-symbols-rounded">chevron_left</span>
          </button>
          <div class="rail-label">
            <span class="material-symbols-rounded">calendar_month</span>
            {{ monthDisplay() }}
          </div>
          <button class="rail-nav right" (click)="changeMonth(1)" aria-label="ä¸‹ä¸€æœˆ">
            <span class="material-symbols-rounded">chevron_right</span>
          </button>
        </div>
      </div>

      <div class="lr-wrap__body">
        <div class="kpi-grid">
          <div class="kpi kpi-blue">
            <div class="kpi-icon"><span class="material-symbols-rounded">description</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">åˆ—è¡¨ç­†æ•¸</div>
              <div class="kpi-num">{{ kpi.list }}</div>
            </div>
          </div>
          <div class="kpi kpi-yellow">
            <div class="kpi-icon"><span class="material-symbols-rounded">schedule</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å¾…å¯©æ ¸</div>
              <div class="kpi-num kpi-yellow-txt">{{ kpi.pending }}</div>
            </div>
          </div>
          <div class="kpi kpi-green">
            <div class="kpi-icon"><span class="material-symbols-rounded">check_circle</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å·²æ ¸å‡†</div>
              <div class="kpi-num kpi-green-txt">{{ kpi.approved }}</div>
            </div>
          </div>
          <div class="kpi kpi-red">
            <div class="kpi-icon"><span class="material-symbols-rounded">cancel</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å·²é§å›</div>
              <div class="kpi-num kpi-red-txt">{{ kpi.rejected }}</div>
            </div>
          </div>
        </div>

        <div class="tabbar">
          <button class="tab" [class.active]="filterStatus === 'all'" (click)="setFilterStatus('all')">å…¨éƒ¨</button>
          <button class="tab" [class.active]="filterStatus === 'pending'" (click)="setFilterStatus('pending')">å¾…å¯©æ ¸</button>
          <button class="tab" [class.active]="filterStatus === 'approved'" (click)="setFilterStatus('approved')">å·²æ ¸å‡†</button>
          <button class="tab" [class.active]="filterStatus === 'rejected'" (click)="setFilterStatus('rejected')">å·²é§å›</button>
        </div>
      </div>
    </div>

    <!-- éŒ¯èª¤/è¼‰å…¥ -->
    @if (errorMsg) {
      <div class="error">{{ errorMsg }}</div>
    }
    @if (loading) {
      <div class="loading">è¼‰å…¥ä¸­...</div>
    }

    <!-- è¡¨æ ¼ -->
    @if (!loading) {
      <div class="card table-card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>å“¡å·¥ç·¨è™Ÿ</th>
                <th>å“¡å·¥å§“å</th>
                <th>è«‹å‡é¡å‹</th>
                <th>è«‹å‡æ™‚é–“</th>
                <th>ç”³è«‹æ—¥æœŸ</th>
                <th>ç‹€æ…‹</th>
              </tr>
            </thead>

            <tbody>
              @if (filteredRows.length === 0) {
                <tr>
                  <td colspan="7" class="empty">
                    <div class="empty-ic">ğŸ“„</div>
                    <div>æŸ¥ç„¡è³‡æ–™</div>
                  </td>
                </tr>
              } @else {
                @for (r of filteredRows; track $index) {
                  <tr class="row">
                    <td><span class="mono">{{ r.employeeId }}</span></td>
                    <td>
                      <div class="emp">
                        <!-- å–å­—ä¸²ç¬¬ 0 å€‹å­— -->
                        <div class="avatar">{{ r.name?.charAt(0) || '?' }}</div>
                        <span class="name">{{ r.name }}</span>
                      </div>
                    </td>
                    <td><span class="{{ typeClass(r.leaveType) }}">{{ r.leaveType }}</span></td>
                    <td><span class="period">{{ tablePeriod(r) }}</span></td>
                    <td><span class="muted">{{ tableApplyDate(r.leaveId) }}</span></td>
                    <td><div class="{{ statusClass(r.status) }}">{{ statusLabel(r.status) }}</div></td>
                  </tr>
                }
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  </div>
</div>
