<div class="page">
  <div class="container">
    <div class="card header lr-wrap">
      <!-- æ¨™é¡Œ + è¿”å› -->
      <div class="lr-wrap__head">
        <div class="page-head">
          <div class="head-left">
            <span class="material-symbols-rounded">calendar_month</span>
            <div>
              <div class="head-title">è«‹å‡ç”³è«‹æŸ¥çœ‹</div>
            </div>
          </div>
          <button class="btn-back" routerLink="/leave" type="button">
            <span class="material-symbols-rounded">arrow_back</span>
            è¿”å›
          </button>
        </div>
      </div>

      <div class="lr-wrap__rail">
        <div class="month-rail">
          <button class="rail-nav left" (click)="changeMonth(-1)" aria-label="ä¸Šä¸€æœˆ">
            <span class="material-symbols-rounded">chevron_left</span>
          </button>
          <div class="rail-label">
            <span class="material-symbols-rounded">calendar_month</span>
            {{ monthDisplay() }}
          </div>
          <button class="rail-nav right" (click)="changeMonth(1)" aria-label="ä¸‹ä¸€æœˆ">
            <span class="material-symbols-rounded">chevron_right</span>
          </button>
        </div>
      </div>

      <div class="lr-wrap__body">
        <div class="kpi-grid">
          <div class="kpi kpi-blue">
            <div class="kpi-icon"><span class="material-symbols-rounded">description</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">åˆ—è¡¨ç­†æ•¸</div>
              <div class="kpi-num">{{ kpi().list }}</div>
            </div>
          </div>
          <div class="kpi kpi-yellow">
            <div class="kpi-icon"><span class="material-symbols-rounded">schedule</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å¾…å¯©æ ¸ï¼ˆä¸ä¾æœˆä»½ï¼‰</div>
              <div class="kpi-num kpi-yellow-txt">{{ kpi().pending }}</div>
            </div>
          </div>
          <div class="kpi kpi-green">
            <div class="kpi-icon"><span class="material-symbols-rounded">check_circle</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å·²æ ¸å‡†</div>
              <div class="kpi-num kpi-green-txt">{{ kpi().approved }}</div>
            </div>
          </div>
          <div class="kpi kpi-red">
            <div class="kpi-icon"><span class="material-symbols-rounded">cancel</span></div>
            <div class="kpi-meta">
              <div class="kpi-label">å·²é§å›</div>
              <div class="kpi-num kpi-red-txt">{{ kpi().rejected }}</div>
            </div>
          </div>
        </div>

        <div class="tabbar">
          <button class="tab" [class.active]="filterStatus() === 'all'" (click)="filterStatus.set('all')">å…¨éƒ¨</button>
          <button class="tab" [class.active]="filterStatus() === 'pending'" (click)="filterStatus.set('pending')">å¾…å¯©æ ¸</button>
          <button class="tab" [class.active]="filterStatus() === 'approved'" (click)="filterStatus.set('approved')">å·²æ ¸å‡†</button>
          <button class="tab" [class.active]="filterStatus() === 'rejected'" (click)="filterStatus.set('rejected')">å·²é§å›</button>
        </div>
      </div>
    </div>

    <!-- éŒ¯èª¤/è¼‰å…¥ -->
    <div *ngIf="errorMsg()" class="error">{{ errorMsg() }}</div>
    <div *ngIf="loading()" class="loading">è¼‰å…¥ä¸­...</div>

    <!-- è¡¨æ ¼ -->
    <div class="card table-card" *ngIf="!loading()">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>å“¡å·¥ç·¨è™Ÿ</th>
              <th>å“¡å·¥å§“å</th>
              <th>è«‹å‡é¡å‹</th>
              <th>è«‹å‡æ™‚é–“</th>
              <th>ç”³è«‹æ—¥æœŸ</th>
              <th>ç‹€æ…‹</th>
              <!-- <th>æ“ä½œ</th> -->
            </tr>
          </thead>

          <tbody>
            <tr *ngIf="filteredRows().length === 0">
              <td colspan="7" class="empty">
                <div class="empty-ic">ğŸ“„</div>
                <div>æŸ¥ç„¡è³‡æ–™</div>
              </td>
            </tr>

            <tr *ngFor="let r of filteredRows(); trackBy: trackById" class="row">
              <td><span class="mono">{{ r.employeeId }}</span></td>
              <td>
                <div class="emp">
                  <div class="avatar">{{ r.name?.charAt(0) || '?' }}</div>
                  <span class="name">{{ r.name }}</span>
                </div>
              </td>
              <td><span class="{{ typeClass(r.leaveType) }}">{{ r.leaveType }}</span></td>
              <td><span class="period">{{ tablePeriod(r) }}</span></td>
              <td><span class="muted">{{ tableApplyDate(r.leaveId) }}</span></td>
              <td><div class="{{ statusClass(r.status) }}">{{ statusLabel(r.status) }}</div></td>
              <!-- <td><button class="link" (click)="openDetails(r)">æŸ¥çœ‹è©³æƒ…</button></td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- è©³æƒ…æµ®å±¤ -->
    <div class="overlay" *ngIf="selectedRow()" (click)="closeDetails()">
      <div class="dialog" (click)="$event.stopPropagation()">
        <div class="dialog-head">
          <div class="head-left">
            <div class="title">è«‹å‡ç”³è«‹è©³æƒ…</div>
            <div class="sub">#{{ selectedRow()!.leaveId }}</div>
          </div>
          <button class="icon-btn white" (click)="closeDetails()">âœ•</button>
        </div>

        <div class="dialog-body">
          <div class="badge-row">
            <div class="{{ statusClass(selectedRow()!.status) }}">{{ statusLabel(selectedRow()!.status) }}</div>
          </div>

          <div class="info-card">
            <h3>å“¡å·¥è³‡è¨Š</h3>
            <div class="info-grid">
              <div>
                <div class="label">å“¡å·¥ç·¨è™Ÿ</div>
                <div class="value mono">{{ selectedRow()!.employeeId }}</div>
              </div>
              <div>
                <div class="label">å“¡å·¥å§“å</div>
                <div class="value">{{ selectedRow()!.name }}</div>
              </div>
            </div>
          </div>

          <div class="info-list">
            <div class="info-item">
              <div class="dot dot-blue"></div>
              <div class="content">
                <div class="label">è«‹å‡é¡å‹</div>
                <div class="value">
                  <span class="{{ typeClass(selectedRow()!.leaveType) }}">{{ selectedRow()!.leaveType }}</span>
                </div>
              </div>
            </div>

            <div class="info-item">
              <div class="dot dot-purple"></div>
              <div class="content">
                <div class="label">è«‹å‡äº‹ç”±</div>
                <div class="value">{{ selectedRow()!.leaveDescription || '-' }}</div>
              </div>
            </div>

            <div class="info-item">
              <div class="dot dot-green"></div>
              <div class="content">
                <div class="label">è«‹å‡æœŸé–“</div>
                <div class="value">{{ periodText(selectedDetails()) }}</div>
              </div>
            </div>

            <div class="info-item" *ngIf="selectedRow()!.leaveProve">
              <div class="dot dot-green"></div>
              <div class="content">
                <div class="label">è«‹å‡æ†‘è­‰</div>
                <div class="value">
                  <img [src]="selectedRow()?.leaveProve" alt="æ†‘è­‰" class="prove"/>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="dialog-foot">
          <button class="btn" (click)="closeDetails()">é—œé–‰</button>
        </div>
      </div>
    </div>
  </div>
</div>
