<div class="reclockin-root">
  <div class="dialog-header">
    <button mat-icon-button (click)="closeAndRefresh()">
      <mat-icon>cancel</mat-icon>
    </button>
  </div>
  <div class="attendance-container">
    <!-- 標題 -->
    <div class="header">
      <div class="company-name">🏢 公司考勤系統</div>
      <div class="welcome-text">歡迎使用打卡系統</div>
    </div>
    <!-- 時間卡 -->
    <div class="time-display">
      <div class="current-time">{{ currentTime }}</div>
      <div class="current-date">{{ currentDate }}</div>
    </div>
    <!-- 按鈕列 -->
    <div class="button-container">
      <!-- 左邊 -->
      <button class="clock-in-btn" (click)="handleLeftButton()" [disabled]="leftDisabled">
        {{ leftLabel }}
      </button>
      <!-- 右邊 -->
      <button class="clock-out-btn" (click)="handleRightButton()" [disabled]="rightDisabled">
        {{ rightLabel }}
      </button>
    </div>
    <!-- 今日打卡記錄 -->
    @if (clockInTime || clockOutTime) {
    <div class="attendance-record">
      <h3>今日打卡記錄</h3>

      @if (clockInTime) {
      <div class="record-item">
        <span class="record-label">上班時間：</span>
        <span class="record-time">{{ formatDisplayTime(clockInTime) }}</span>
      </div>
      }

      @if (clockOutTime) {
      <div class="record-item">
        <span class="record-label">下班時間：</span>
        <span class="record-time">{{ formatDisplayTime(clockOutTime) }}</span>
      </div>
      }

      @if (workDuration) {
      <div class="work-duration-card">
        <div class="duration-chip">工作時長： {{ workDuration }}</div>
      </div>
      }
    </div>
    }
  </div>

  <!-- 心情評分 -->
  @if (showMoodRating) {
  <!-- $event  代表目前發生的事件物件（這裡是滑鼠點擊事件 MouseEvent）。
    stopPropagation()  是瀏覽器事件物件自帶的方法，用來 阻止事件冒泡。 -->
  <div class="modal-overlay" (click)="closeMoodRating()">
    <div class="mood-modal" (click)="$event.stopPropagation()">
      <div class="mood-header">
        <div class="mood-icon">😊</div>
        <h2 class="mood-title">評價今日心情</h2>
        <p class="mood-subtitle">請為您今天的工作心情評分</p>
      </div>

      <!-- 星星評分 -->
      <div class="star-rating">
        @for (star of [1,2,3,4,5]; track star) {
        <!-- 代表：當滑鼠移到這顆星星上時，呼叫 setHoveredStar(star)，把這顆星的數字傳進去。
              代表：當滑鼠離開這顆星星時，呼叫 setHoveredStar(0)，把暫時的預覽清掉。 -->
        <button class="star-button" (mouseenter)="setHoveredStar(star)" (mouseleave)="setHoveredStar(0)"
          (click)="setMoodRating(star)">
          <!-- 如果有「滑鼠暫時移到的星星」，就用它；否則用「已選定的評分」。-->
          <svg class="star-icon" [class.star-filled]="star <= (hoveredStar || moodRating)" width="36" height="36"
            viewBox="0 0 24 24" fill="currentColor">
            <!-- 請跟隨這個元素目前的文字顏色 (color)」 -->
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
          </svg>
        </button>
        }
      </div>

      <!-- 固定高度的心情文字 -->
      <div class="mood-description">
        <span class="mood-text">{{ getMoodText(hoveredStar || moodRating) }}</span>
      </div>

      <!-- 統一樣式的按鈕 -->
      <div class="mood-buttons">
        <button class="mood-btn cancel-btn" (click)="closeMoodRating()">取消</button>
        <button class="mood-btn confirm-btn" (click)="completeClockOut()" [disabled]="moodRating  === 0">確定打卡</button>
      </div>
    </div>
  </div>
  }

  <!-- 成功提示 -->
  @if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="success-icon">{{ modalData.icon }}</div>
      <div class="modal-title">{{ modalData.title }}</div>
      <!-- Angular 會把這段字串 當成 HTML 插入 -->
      <div class="modal-content" [innerHTML]="modalData.content"></div>
      <button class="close-btn" (click)="closeModal()">確定</button>
    </div>
  </div>
  }
</div>