<div class="reclockin-root">
  <div class="dialog-header">
    <button mat-icon-button (click)="closeAndRefresh()">
      <mat-icon>cancel</mat-icon>
    </button>
  </div>
  <div class="attendance-container">
    <!-- æ¨™é¡Œ -->
    <div class="header">
      <div class="company-name">ğŸ¢ å…¬å¸è€ƒå‹¤ç³»çµ±</div>
      <div class="welcome-text">æ­¡è¿ä½¿ç”¨æ‰“å¡ç³»çµ±</div>
    </div>
    <!-- æ™‚é–“å¡ -->
    <div class="time-display">
      <div class="current-time">{{ currentTime }}</div>
      <div class="current-date">{{ currentDate }}</div>
    </div>
    <!-- æŒ‰éˆ•åˆ— -->
    <div class="button-container">
      <!-- å·¦é‚Š -->
      <button class="clock-in-btn" (click)="handleLeftButton()" [disabled]="leftDisabled">
        {{ leftLabel }}
      </button>
      <!-- å³é‚Š -->
      <button class="clock-out-btn" (click)="handleRightButton()" [disabled]="rightDisabled">
        {{ rightLabel }}
      </button>
    </div>
    <!-- ä»Šæ—¥æ‰“å¡è¨˜éŒ„ -->
    @if (clockInTime || clockOutTime) {
    <div class="attendance-record">
      <h3>ä»Šæ—¥æ‰“å¡è¨˜éŒ„</h3>

      @if (clockInTime) {
      <div class="record-item">
        <span class="record-label">ä¸Šç­æ™‚é–“ï¼š</span>
        <span class="record-time">{{ formatDisplayTime(clockInTime) }}</span>
      </div>
      }

      @if (clockOutTime) {
      <div class="record-item">
        <span class="record-label">ä¸‹ç­æ™‚é–“ï¼š</span>
        <span class="record-time">{{ formatDisplayTime(clockOutTime) }}</span>
      </div>
      }

      @if (workDuration) {
      <div class="work-duration-card">
        <div class="duration-chip">å·¥ä½œæ™‚é•·ï¼š {{ workDuration }}</div>
      </div>
      }
    </div>
    }
  </div>

  <!-- å¿ƒæƒ…è©•åˆ† -->
  @if (showMoodRating) {
  <!-- $event  ä»£è¡¨ç›®å‰ç™¼ç”Ÿçš„äº‹ä»¶ç‰©ä»¶ï¼ˆé€™è£¡æ˜¯æ»‘é¼ é»æ“Šäº‹ä»¶ MouseEventï¼‰ã€‚
    stopPropagation()  æ˜¯ç€è¦½å™¨äº‹ä»¶ç‰©ä»¶è‡ªå¸¶çš„æ–¹æ³•ï¼Œç”¨ä¾† é˜»æ­¢äº‹ä»¶å†’æ³¡ã€‚ -->
  <div class="modal-overlay" (click)="closeMoodRating()">
    <div class="mood-modal" (click)="$event.stopPropagation()">
      <div class="mood-header">
        <div class="mood-icon">ğŸ˜Š</div>
        <h2 class="mood-title">è©•åƒ¹ä»Šæ—¥å¿ƒæƒ…</h2>
        <p class="mood-subtitle">è«‹ç‚ºæ‚¨ä»Šå¤©çš„å·¥ä½œå¿ƒæƒ…è©•åˆ†</p>
      </div>

      <!-- æ˜Ÿæ˜Ÿè©•åˆ† -->
      <div class="star-rating">
        @for (star of [1,2,3,4,5]; track star) {
        <!-- ä»£è¡¨ï¼šç•¶æ»‘é¼ ç§»åˆ°é€™é¡†æ˜Ÿæ˜Ÿä¸Šæ™‚ï¼Œå‘¼å« setHoveredStar(star)ï¼ŒæŠŠé€™é¡†æ˜Ÿçš„æ•¸å­—å‚³é€²å»ã€‚
              ä»£è¡¨ï¼šç•¶æ»‘é¼ é›¢é–‹é€™é¡†æ˜Ÿæ˜Ÿæ™‚ï¼Œå‘¼å« setHoveredStar(0)ï¼ŒæŠŠæš«æ™‚çš„é è¦½æ¸…æ‰ã€‚ -->
        <button class="star-button" (mouseenter)="setHoveredStar(star)" (mouseleave)="setHoveredStar(0)"
          (click)="setMoodRating(star)">
          <!-- å¦‚æœæœ‰ã€Œæ»‘é¼ æš«æ™‚ç§»åˆ°çš„æ˜Ÿæ˜Ÿã€ï¼Œå°±ç”¨å®ƒï¼›å¦å‰‡ç”¨ã€Œå·²é¸å®šçš„è©•åˆ†ã€ã€‚-->
          <svg class="star-icon" [class.star-filled]="star <= (hoveredStar || moodRating)" width="36" height="36"
            viewBox="0 0 24 24" fill="currentColor">
            <!-- è«‹è·Ÿéš¨é€™å€‹å…ƒç´ ç›®å‰çš„æ–‡å­—é¡è‰² (color)ã€ -->
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
          </svg>
        </button>
        }
      </div>

      <!-- å›ºå®šé«˜åº¦çš„å¿ƒæƒ…æ–‡å­— -->
      <div class="mood-description">
        <span class="mood-text">{{ getMoodText(hoveredStar || moodRating) }}</span>
      </div>

      <!-- çµ±ä¸€æ¨£å¼çš„æŒ‰éˆ• -->
      <div class="mood-buttons">
        <button class="mood-btn cancel-btn" (click)="closeMoodRating()">å–æ¶ˆ</button>
        <button class="mood-btn confirm-btn" (click)="completeClockOut()" [disabled]="moodRating  === 0">ç¢ºå®šæ‰“å¡</button>
      </div>
    </div>
  </div>
  }

  <!-- æˆåŠŸæç¤º -->
  @if (showModal) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="success-icon">{{ modalData.icon }}</div>
      <div class="modal-title">{{ modalData.title }}</div>
      <!-- Angular æœƒæŠŠé€™æ®µå­—ä¸² ç•¶æˆ HTML æ’å…¥ -->
      <div class="modal-content" [innerHTML]="modalData.content"></div>
      <button class="close-btn" (click)="closeModal()">ç¢ºå®š</button>
    </div>
  </div>
  }
</div>